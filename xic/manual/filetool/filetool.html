<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>FileTool Reference Manual</TITLE>
<!-- $Id: filetool.html,v 1.1 2007/01/09 03:39:39 stevew Exp $ -->
</HEAD>

<body bgcolor="#e8e8f0" text="#000000" link="#9c009e" vlink="#551a8b"
 alink="#ff0000">

<center>
<h1> FileTool Reference Manual</h1>

<i>FileTool</i> Release 1.0  January 6, 2007<br>
<font face=helvetica size=2>
Copyright &#169 Whiteley Research Inc. 2007, All Rights Reserved.
</font><br><br>
<font size=+2>Whiteley Research Inc.</font><br>
456 Flora Vista Ave.<br>
Sunnyvale, CA 94086<br>
(408) 735-8973<br>
(408) 245-4033 (fax)<br>
<a href="http://www.wrcad.com"><tt>www.wrcad.com</tt></a><br>
</center>

<h2>Contents</h2>
<ol>
<li><a href="#intro"><b>Introduction</b></a>
<li><a href="#cmdline"><b>Command Line Options</b></a>
<li><a href="#analmode"><b>Analysis Mode</b></a><br>
3.1. <a href="#infoarg"><b>The <tt>-info</tt> option</b></a><br>
3.2. <a href="#textarg"><b>The <tt>-text</tt> option</b></a>
<li><a href="#synthmode"><b>Synthesis Mode</b></a>
<li><a href="#format"><b>The Script File Format</b></a>
</ol>

<a name="intro"></a>
<h2>1. Introduction</h2>

The <i>FileTool</i> is a command-line program for analysis and
manipulation of layout files.  It is intended to be incorporated in
the user's automation scripts to implement complicated manipulations
on layout files, and as an aid to understanding content and diagnosing
problems with layout files.

<p>
Here are some of the tasks that the <i>FileTool</i> can perform:
<dl>
<dt><b>Anaylsis Mode</b><dd>
  Determine the layers/datypes used, object and record counts, bounding
  boxes, cell names, and more from an unknown layout file.

  <p>
  Convert all or part of a layout file to an ascii text representation,
  which can be examined by the user to identify problems with the
  file.
</dl>

<dl>
<dt><b>Synthesis Mode</b><dd>

  Several layout files can be merged into a larger layout file,
  on-the-fly so as to avoid memory limitations.  The output may consist
  of a definition of a top-level cell, containing instances of cells
  found in the source files, plus the translated records from the
  source files files.  The creation of a top-level cell is optional.

  <p>
  One can convert between file formats, with possible scaling,
  windowing, flattening, cell name modification, layer filtering and
  aliasing.  It is also possible to extract cell hierarchies from
  multiple layout files, and place these in a cell in an output file,
  after applying transformations.  The filtering, windowing, etc. 
  operations can also be applied.

  <p>
  Only physical data are translated, electrical data will be stripped. 
  A log file s produced when the command is run.  This is named
  "<tt>fileinfo.log</tt>" and is written in the current directory.
</dl>

<p>
The file formats supported by the <i>FileTool</i> are:

<dl>
<dt>GDSII<dd>
The industry standard stream format.  Any release level is supported for
input.  For output, the default release level is 7, but this can be
set to earlier levels.  Compressed (gzipped) GDSII files can be read
or written.
</dl>

<dl>
<dt>OASIS<dd>
The emerging standard, which provides more compact data files than
GDSII.  Any conforming OASIS file can be read as input.  A number of
options affect OASIS output.
</dl>

<dl>
<dt>CGX<dd>
A compact data representation developed by Whiteley Research Inc.
Compressed (gzipped) CGX files can be read or written.
</dl>

<dl>
<dt>CIF<dd>
The obsolete but still used CIF format.  Any known dialect should work
as input.  The output dialect can be selected via options.
</dl>

<p>
Input files can be any of these file types, the format is recognized
by context.  Output files can also be any of these file types, but the
format is specified by the extension of the file name.

<p>
The operations can be saved to a script file, or read from a script
file.  The script file format is the same as used by the
<b>!assemble</b> command in Xic, thus scripts generated by the
<i>FileTool</i> can be executed in <i>Xic</i>.

<a name="cmdline"></a>
<h2>2. Command Line Options</h2>

If <i>FileTool</i> is executed without arguments, a synopsis of
available command line options is printed.  Otherwise, the arguments
are given in one of the following forms.

<blockquote>
<tt>filetool</tt> <i>script_file_to_read</i>
</blockquote>

<p>
If a single argument appears, the argument is taken as a path to a
script file, which will be read and executed.  All of the available
file manipulation operations can be specified in a script.  The script
file format is described <a href="#format">below</a>, and in the
<i>Xic</i> documentation for the <b>!assemble</b> command.

<blockquote>
<tt>filetool</tt> <tt>-info</tt> <i>layout_file</i> [<i>flags</i>]
</blockquote>

Information about <i>layout_file</i> will be printed.

<blockquote>
<tt>filetool</tt> <tt>-text</tt> <i>layout_file</i>
 [<tt>-set</tt> <i>var</i>[=<i>value</i>]] [<tt>-o</tt> <i>output_file</i>]
 [<i>start</i>[-<i>end]</i>] [<tt>-c</tt> <i>cells</i>]
 [<tt>-r</tt> <i>recs</i>]
</blockquote>

All or part of <i>layout_file</i> will be translated to an ascii text
representation.

<blockquote>
<tt>filetool</tt><br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-d</tt> <i>script_file_to_write</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-set</tt> <i>var</i>[=<i>value</i>]]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<tt>-o</tt> <i>output_file</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-t</tt> <i>top_cell_name</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-v</tt>[<tt>v</tt>] (verbosity)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[per-source options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<tt>-i</tt> <i>input_file</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-source options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[<tt>-c</tt> <i>cellname</i> | <tt>-ctop</tt>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-ca</tt> <i>cellname_alias</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... ]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-i</tt> ... ]
</blockquote>

<p>
Per-source options:
<blockquote>
<table border=1 bgcolor="#ffffee">
<tr><td><tt>-l</tt> <i>layer_list</i></td> <td>Declare a list of layer
  names</td></tr>
<tr><td><tt>-n</tt>[+|-]</td> <td>Ignore layers <b>not</b> in
  <i>layer_list</i></td></tr>
<tr><td><tt>-k</tt>[+|-]</td> <td>Ignore lauers in <i>layer_list</i></td></tr>
<tr><td><tt>-a</tt> <i>layer_aliases</i></td> <td>Declare list of layer
  mappings</td></tr>
<tr><td><tt>-s</tt> <i>scale</i></td> <td>Scale all coordinates</td></tr>
<tr><td><tt>-p</tt> <i>prefix<i></td> <td>Add or modify cell names
  prefix</td></tr>
<tr><td><tt>-u</tt> <i>suffix</i></td> <td>Add or modify cell names
  suffix</td></tr>
<tr><td><tt>-tlo</tt>[+|-]</td> <td>Cell names to lower case</td></tr>
<tr><td><tt>-tup</tt>[+|-]</td> <td>Cell names to upper case</td></tr>
</table>
</blockquote>
 
<p>
Per-instance options:
<blockquote>
<table border=1 bgcolor="#ffffee">
<tr><td><tt>-m</tt> <i>magn</i></td> <td>Set instance magnification</td></tr>
<tr><td><tt>-x</tt> <i>x</i></td> <td>Set translation X value</td></tr>
<tr><td><tt>-y</tt> <i>y</i></td> <td>Set translation Y value</td></tr>
<tr><td><tt>-ang</tt> <i>angle</i></td> <td>Set rotation angle, multiple of
  45 degrees</td></tr>
<tr><td><tt>-my</tt>[+|-]</td> <td>Set Y-reflection</td></tr>
<tr><td><tt>-f</tt>[+|-]</td> <td>Flatten cell hierarchy</td></tr>
<tr><td><tt>-e</tt>[+|-]</td> <td>Remove empty cells</td></tr>
<tr><td><tt>-w</tt> <i>l,b,r,t<i></td> <td>Set windowing box
  coordinates</td></tr>
<tr><td><tt>-clip</tt>[+|-]</td> <td>Clip objects at window boundary</td></tr>
</table>
</blockquote>

A new layout file will be generated, as per the directives.

<a name="analmode"></a>
<h3>3. Analysis Mode</h3>

If the first argument is <tt>-info</tt> or <tt>-text</tt>, the
<i>FileTool</i> will perform file content analysis rather than
synthesis.

<a name="infoarg"></a>
<h4>3.1. The <tt>-info</tt> option</h4>

<blockquote>
<tt>filetool</tt> <tt>-info</tt> <i>layout_file</i> [<i>flags</i>]
</blockquote>

<p>
The <tt>-info</tt> argument must be followed by a path to a layout
file, which is optionally followed by a flags argument.  This will dump
information and statistics to standard output.  The flags control
which possible output fields are generated.  This is virtually the
same as the <b>!fileinfo</b> command and
<tt>FileInfo</tt>/<tt>CxInfo</tt> script functions in <i>Xic</i>.

<p>
The optional flags argument is a space or comma-separated list of
tokens (the list should be quoted if it contains white space).  The
tokens can be <i>hex</i> integers, or the keyword equivalents from the
table below.
    
<p>
If not given or given as 0, all flags except for
<tt>allcells</tt>, <tt>instances</tt>, and <tt>flags</tt> are
taken as set.  This avoids printing the lengthly cells/instances
list by default.  The keyword <tt>all</tt> or value -1 can be used
to obtain all available information.

<blockquote>
<table border=0>
<tr><th>Keyword</th> <th>Value</th></tr>
<tr><td><tt>filename</tt></td>     <td><tt>0x1</tt></td></tr>
<tr><td><tt>filetype</tt></td>     <td><tt>0x2</tt></td></tr>
<tr><td><tt>objcounts</tt></td>    <td><tt>0x4</tt></td></tr>
<tr><td><tt>reccounts</tt></td>    <td><tt>0x8</tt></td></tr>
<tr><td><tt>estsize</tt></td>      <td><tt>0x10</tt></td></tr>
<tr><td><tt>estcxsize</tt></td>    <td><tt>0x20</tt></td></tr>
<tr><td><tt>estsksize</tt></td>    <td><tt>0x40</tt></td></tr>
<tr><td><tt>layers</tt></td>       <td><tt>0x8</tt></td></tr>
<tr><td><tt>topcells</tt></td>     <td><tt>0x100</tt></td></tr>
<tr><td><tt>allcells</tt></td>     <td><tt>0x200</tt></td></tr>
<tr><td><tt>offsort</tt></td>      <td><tt>0x400</tt></td></tr>
<tr><td><tt>offset</tt></td>       <td><tt>0x800</tt></td></tr>
<tr><td><tt>instances</tt></td>    <td><tt>0x1000</tt></td></tr>
<tr><td><tt>bbs</tt></td>          <td><tt>0x2000</tt></td></tr>
<tr><td><tt>flags</tt></td>        <td><tt>0x4000</tt></td></tr>
<tr><td><tt>depthcnts</tt></td>    <td><tt>0x8000</tt></td></tr>
<tr><td><tt>unresolved</tt></td>   <td><tt>0x10000</tt></td></tr>
<tr><td><tt>all</tt></td>          <td><tt>-1</tt></td></tr>
</table>
</blockquote>

<p>
The information provided by these flags is fully described below.

<dl>
<dt><tt>filename</tt><dd>
Print the name of the layout file for which the information applies.
</dl>

<dl>
<dt><tt>filetype</tt><dd>
Print a string giving the format of the layout file:  one of
"<tt>CIF</tt>", "<tt>CGX</tt>", "<tt>GDSII</tt>", or
"<tt>OASIS</tt>".
</dl>

<dl>
<dt><tt>objcounts</tt><dd>
Print a table of object counts found in the layout file.  The table
contains the following keywords, each followed by a number.
<table border=1 bgcolor="#ffffee">
<tr><th>Keyword</th> <th>Descripption</th></tr>
<tr><td><tt>Records</tt></td> <td>Total record count</td></tr>
<tr><td><tt>Symbols</tt></td> <td>Number of cell definitions</td></tr>
<tr><td><tt>Boxes</tt></td> <td>Number of rectangles</td></tr>
<tr><td><tt>Polygons</tt></td> <td>Number of polygons</td></tr>
<tr><td><tt>Wires</tt></td> <td>Number of wire paths</td></tr>
<tr><td><tt>Avg Verts</tt></td> <td>Average vertex count per poly or
  wire</td></tr>
<tr><td><tt>Labels</tt></td> <td>Number of (non-physical) labels</td></tr>
<tr><td><tt>Srefs</tt></td> <td>Number of non-arrayed instances</td></tr>
<tr><td><tt>Arefs</tt></td> <td>Number of arrayed instances</td></tr>
</table>
</dl>

<dl>
<dt><tt>reccounts</tt><dd>
Print a table of the counts for record types found in the layout.
This is format-dependent.
</dl>

<dl>
<dt><tt>estsize</tt><dd>
This flag will enable printing of the estimated memory required to
read the entire file into <i>Xic</i>.  The system must be able to
provide at least this much memory for a read to succeed.
</dl>

<dl>
<dt><tt>estcxsize</tt><dd>
<i>Xic</i> and the <i>FileTool</i> use an "archive context" data
structure to hold information after scanning a file.  This data
structure has many uses.  If this flag is set, an estimate of the size
of this data structure is printed.
</dl>

<dl>
<dt><tt>estsksize</tt><dd>
Print an estimate of the memory needed to read the layout in skeleton
mode in <i>Xic</i>.  This is the memory space used to hold the
cell/instance hierarchy, without geometry.
</dl>

<dl>
<dt><tt>layers</tt><dd>
Print a list of the layer names encountered in the layout.  For file
formats that have a numerical layer/datatype, the layer "names" are
encodings as described for the <a href="#lyrenc"><i>layer_list</i></a>
synthesis argument.
</dl>

<dl>
<dt><tt>topcells</tt><dd>
List the top-level cells, i.e., the cells in the file that are not
used as a subcell by another cell in the file.  If
<tt>allcells</tt> is also given, only the names are listed,
otherwise the cells are listed including the <tt>offset</tt>,
<tt>instances</tt>, <tt>bbs</tt>, and <tt>flags</tt> fields if
these flags are set.  The list will be sorted as per
<tt>offsort</tt>.
</dl>

<dl>
<dt><tt>allcells</tt><dd>
All cells found in the file are listed by name, including the
<tt>offset</tt>, <tt>instances</tt>, <tt>bbs</tt>, and
<tt>flags</tt> fields if these flags are also given.  The list
will be sorted as per <tt>offsort</tt>.
</dl>

The following flags apply only if at least one of
<tt>topcells</tt> or <tt>allcells</tt> is given.

<dl>
<dt><tt>offsort</tt><dd>
If this flag is set, the cells will be listed in ascending order
of the file offset, i.e., in the order in which the cell
definitions appear in the layout file.  If not set, cells are
listed alphabetically.
</dl>

<dl>
<dt><tt>offset</tt><dd>
When set, the cell name is followed by the offset of the cell
definition record in the layout file.  This is given as a decimal
number enclosed in square brackets.
</dl>

<dl>
<dt><tt>instances</tt><dd>
For each cell, the subcells used in the cell are listed.  The subcell
names are indented and listed below the cell name.
</dl>

<dl>
<dt><tt>bbs</tt><dd>
For each cell the bounding box is shown, in L,B R,T form.  For
subcells, the position, transformation, and array parameters are
shown.  Coordinates are given in microns.  The subcell
transformation and array parameters are represented by a
concatenation of the following tokens, which follow the subcell
reference position.  These are similar to the transformation
tokens found in CIF, and have the same meanings.

<table border=0 cellspacing=2>
<tr><td><tt>MY</tt></td> <td>Mirror about the x-axis.</td></tr>
<tr><td><tt>R</tt><i>i</i>,<i>j</i></td>  <td>Rotate by an angle
  given by the vector <i>i</i>,<i>j</i>.</td></tr>
<tr><tt>M</tt><i>mag</i></td> <td>Magnify by <i>mag</i>.</td></tr>
<tr><tt>A</tt><i>nx</i>,<i>ny</i>,<i>dx</i>,<i>dy</i></dt> <dt>Specifies
  an array, <i>nx</i> x <i>ny</i> with spacings <i>dx</i>,
  <i>dy</i>.</td></tr>
</table>
</dl>

<dl>
<dt><tt>flags</tt><dd>
The flags, which are internal, are not used in the <i>FileTool</i>
<tt>-info</tt> mode, and will be listed as 0.
</dl>

<dl>
<dt><tt>depthcnts</tt><dd>
A table of the number of cell instantiations at each hierarchy
level is printed, for each top-level cell found in the file.  The
count for depth 0 is 1 (the top-level cell), the count at depth 1
is the number of subcells of the top-level cell, depth 2 is the
number of subcells of these subcells, etc.  Arrays are given one
count, the same as a single instance.
</dl>

<dl>
<dt><tt>unresolved</tt><dd>
This will list cells that are referenced but not defined in the
file.  These will also be listed if <tt>allcells</tt> is given.  A
valid layout file will not contain unresolved references.
</dl>

<dl>
<dt><tt>all</tt><dd>
This enables all flags.
</dl>

<a name="textarg"></a>
<h4>3.2. The <tt>-text</tt> option</h4>

<blockquote>
<tt>filetool</tt> <tt>-text</tt> <i>layout_file</i>
 [<tt>-set</tt> <i>var</i>[=<i>value</i>]] [<tt>-o</tt> <i>output_file</i>]
 [<i>start</i>[-<i>end]</i>] [<tt>-c</tt> <i>cells</i>]
 [<tt>-r</tt> <i>recs</i>]
</blockquote>

<p>
If the first argument is "<tt>-text</tt>", then the following argument
must be a path to a layout file.  In this mode, parts or all of the
layout file will be written in an ascii text form, which the user can
inspect directly.

<p>
Following the file path, there are optional arguments.

<dl>
<dt><tt>-set</tt> <i>var</i>[=<i>value</i>]<dd>
There are some internal modes that can be set by setting variables. 
These can be set with the <tt>-set</tt> option.  The option is
followed by a "name=value" token, consisting of the variable name from
the table below, and its value following an '=' sign.  For boolean
variables, the '=' sign and value are absent.  Quoting should be used
to "hide" any white space.  The following variables have significance
in <tt>-text</tt> mode:

  <dl>
  <dt><b>OasPrintNoWrap</b><dd>
  <b>Value:</b> boolean.<br>
  This applies when converting OASIS input to ascii text.  When set,
  the text output for a single record will occupy one (arbitrarily
  long) line.  When not set, lines are broken and continued with
  indentation.
  </dl>

  <dl>
  <dt><b>OasPrintOffset</b><dd>
  <b>Value:</b> boolean.<br>
  This applies when converting OASIS input to ascii text.  When set,
  the first token for each record output gives the offset in the
  file or containing CBLOCK.  When not set, file offsets are not
  printed.
  </dl>
</dl>

<dl>
<dt><tt>-o</tt> <i>output_file</i><dd>
  If this is given, the text output will be placed in the supplied
  file name.  Without this option given, text output is to the
  standard output.
</dl>

<p>
The remaining arguments control the range of text conversion.  Without
these options, the entire file will be written as ascii text.  For all
but tiny layout files, the user will probably want to limit the size of
the output.

<dl>
<dt>[<i>start</i>[-<i>end</i>]]<dd>
The <i>start</i> and <i>end</i> are file offsets, which can be given
in decimal or "<tt>0x</tt>" hex form.  Printing will start with the
first record with offset greater than or equal to <i>start</i>.  If
<i>end</i> is given, the last record printed will be at most the
record containing this offset.  If both numbers are given, they must
be separated by a '-' with no white space.
</dl>

<dl>
<dt>[<tt>-c</tt> <i>cells</i>]<dd>
This options supplies a count, indicating the number of cell
definitions that will be printed.  If the count is 0, and <i>start</i>
is also given, the records from <i>start</i> to the end of the cell
definition will be printed.
</dl>

<dl>
<dt>[<tt>-r</tt> <i>recs</i>]<dd>
This provides a count of the number of records to print.  Printing will
stop after the indicated number of records have been output.
</dl>

<p>
Printing will start at the beginning of the file or the <i>start</i>
record if given, and will end at the end of file or the point at which
the first end condition is satisfied.

<a name=synthmode"></a>
<h2>4. Synthesis Mode</h2>

<blockquote>
<tt>filetool</tt><br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-d</tt> <i>script_file_to_write</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-set</tt> <i>var</i>[=<i>value</i>]]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<tt>-o</tt> <i>output_file</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-t</tt> <i>top_cell_name</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-v</tt>[<tt>v</tt>] (verbosity)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[per-source options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<tt>-i</tt> <i>input_file</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-source options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[<tt>-c</tt> <i>cellname</i> | <tt>-ctop</tt>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-ca</tt> <i>cellname_alias</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[per-instance options]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... ]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[<tt>-i</tt> ... ]
</blockquote>

<p>
Per-source options:
<blockquote>
<table border=1 bgcolor="#ffffee">
<tr><td><tt>-l</tt> <i>layer_list</i></td> <td>Declare a list of layer
  names</td></tr>
<tr><td><tt>-n</tt>[+|-]</td> <td>Ignore layers <b>not</b> in
  <i>layer_list</i></td></tr>
<tr><td><tt>-k</tt>[+|-]</td> <td>Ignore lauers in <i>layer_list</i></td></tr>
<tr><td><tt>-a</tt> <i>layer_aliases</i></td> <td>Declare list of layer
  mappings</td></tr>
<tr><td><tt>-s</tt> <i>scale</i></td> <td>Scale all coordinates</td></tr>
<tr><td><tt>-p</tt> <i>prefix<i></td> <td>Add or modify cell names
  prefix</td></tr>
<tr><td><tt>-u</tt> <i>suffix</i></td> <td>Add or modify cell names
  suffix</td></tr>
<tr><td><tt>-tlo</tt>[+|-]</td> <td>Cell names to lower case</td></tr>
<tr><td><tt>-tup</tt>[+|-]</td> <td>Cell names to upper case</td></tr>
</table>
</blockquote>
 
<p>
Per-instance options:
<blockquote>
<table border=1 bgcolor="#ffffee">
<tr><td><tt>-m</tt> <i>magn</i></td> <td>Set instance magnification</td></tr>
<tr><td><tt>-x</tt> <i>x</i></td> <td>Set translation X value</td></tr>
<tr><td><tt>-y</tt> <i>y</i></td> <td>Set translation Y value</td></tr>
<tr><td><tt>-ang</tt> <i>angle</i></td> <td>Set rotation angle, multiple of
  45 degrees</td></tr>
<tr><td><tt>-my</tt>[+|-]</td> <td>Set Y-reflection</td></tr>
<tr><td><tt>-f</tt>[+|-]</td> <td>Flatten cell hierarchy</td></tr>
<tr><td><tt>-e</tt>[+|-]</td> <td>Remove empty cells</td></tr>
<tr><td><tt>-w</tt> <i>l,b,r,t<i></td> <td>Set windowing box
  coordinates</td></tr>
<tr><td><tt>-clip</tt>[+|-]</td> <td>Clip objects at window boundary</td></tr>
</table>
</blockquote>

<p>
This mode allows cells te be extracted from one or more layout files,
processed, and combined into a single output file.

<p>
The order of the options given is important and should follow the
template above.

<p>
If the <tt>-d</tt> option is given, a script file will be generated
which will automate the operations specified by the other arguments. 
The operations will not actually be performed.  If the script file is
subsequently given to the <i>FileTool</i> as a single argument, the
operations will be carried out.  The format of the script file will be
described <a href="#format">later</a>.

<p>
There are some internal modes that can be set by setting variables.  These
can be set with the <tt>-set</tt> option.  The option is
followed by a "name=value" token, consisting of the variable name from
the table below, and its value following an '=' sign.  For boolean
variables, the '=' sign and value are absent.  Quoting should be used
to "hide" any white space.  The variables that have significance in
synthesis mode are the following:

  <dl>
  <dt><b>OasReadNoChecksum</b><dd>
  <b>Value:</b> boolean.<br>
  When set, the reader will ignore a checksum found in the OASIS
  file, if any.  When not set, if a checksum is found, it will be
  compared with a computed checksum, using the method (CRC or
  summation) indicated in the file, and the conversion will fail if
  the checksums are not equal.
  </dl>

  <dl>
  <dt><b>CifOutStyle</b> (string)<dd>
  <b>Value:</b> string.<br>
  When set, this variable will determine the CIF output style.  If the
  variable is not set, reading a CIF file will set the internal style
  parameters, so that if a CIF file is written, it will have the same
  style.

  <p>
  The <b>CifOutStyle</b> variable can be set to the following
  values, which will set the CIF output style as indicated.

  <p>
  <table border=1 bgcolor="#ffffee">
  <tr><th>Value</th><th> Historical Name</th><th> cname_index</th><th>
   layer_index</th><th> label_index</th></tr>
  <tr><td><tt>a</tt></td><td>
   Stanford</td><td> 1</td><td> 0</td><td> 1</td></tr>
  <tr><td><tt>b</tt></td><td>
   NCA</td><td> 1</td><td> 1</td><td> 2</td></tr>
  <tr><td><tt>i</tt></td><td>
   Icarus</td><td> 2</td><td> 0</td><td> 1</td></tr>
  <tr><td><tt>m</tt></td><td>
   Mextra</td><td> 0</td><td> 0</td><td> 3</td></tr>
  <tr><td><tt>n</tt></td><td>
   none</td><td> 4</td><td> 0</td><td> 4</td></tr>
  <tr><td><tt>s</tt></td><td>
   Sif</td><td> 3</td><td> 0</td><td> 1</td></tr>
  <tr><td><tt>x</tt></td><td>
   Xic</td><td> 0</td><td> 0</td><td> 0</td></tr>
  <tr><td><i>cn</i>:<i>la</i>:<i>lb</i></td><td> -
   </td><td> <i>cn</i> </td><td> <i>la</i> </td><td> <i>lb</i></td></tr>
  </table>

  <p>
  The final form consists of three colon-separated integers which
  are interpreted as indices into the option lists as implied above.

  <p>
  <b>CIF Cell Name Extensions</b><br>

  <p>
  Cell names were not part of the original CIF syntax specification.
  Various extensions have been used to supply cell names in a CIF
  file.  Each of these extensions consists of command following the
  "<tt>DS</tt> ...;" command, in the following forms:

  <p>
  <table border=1 bgcolor="#ffffee">
  <tr><th>cname_index</th><th>Historic Name</th><th>Format</th></tr>
  <tr><td>0</td><td> IGS</td><td>    <tt>9</tt> <i>cell_name</i>;</td></tr>
  <tr><td>1</td><td> Stanford/NCA</td><td> (<i>cell_name</i>);</td></tr>
  <tr><td>2</td><td> Icarus</td><td> (<tt>9</tt> <i>cell_name</i>);</td></tr>
  <tr><td>3</td><td> Sif</td><td> (<tt>Name:</tt> <i>cell_name</i>);</td></tr>
  <tr><td>4</td><td> none</td><td>         no extension used</td></tr>
  </table>

  <p>
  Any of the first four forms (indices 0-3) will be recognized
  equivalently when reading CIF input.

  <p>
  <b>CIF layer specification</b><br>

  <p>
  Layers are specified in CIF in a command with syntax
  <blockquote>
  <tt>L</tt> <i>token</i>;
  </blockquote>

  The the <i>token</i> can be interpreted in two ways; as the name of
  a layer, or as an index into a layer table.  For the second
  interpretation, the token must of course be an integer.  This
  indirection is not presently supported in the <i>FileTool</i>,
  so only the first (0) choice can be applied.

  <p>
  <table border=1 bgcolor="#ffffee">
  <tr><th>layer_index</th><th>  Historic Name</th><th>   Format</th></tr>
  <tr><td>0</td><td>  none</td><td>  <tt>L</tt> <i>layer_name</i>;</td></tr>
  <tr><td>1</td><td>  NCA</td><td>   <tt>L</tt> <i>layer_index</i>;</td></tr>
  </table>

  <p>
  <b>CIF Label Extensions</b></br>

  <p>
  Text labels were not part of the original CIF syntax specification,
  so that various extensions are used to pass label information.

  <p>
  <table border=1 bgcolor="#ffffee">
  <tr><th>label_index</th><th>  Historic Name</th><th>   Format</th></tr>
  <tr><td>0</td><td> Xic</td><td>
   <tt>94</tt> &#60&#60<i>label</i>>>
   <i>x y orient_code width height</i>;</td></tr>
  <tr><td>1</td><td> KIC</td><td>    <tt>94</tt> <i>label x y</i>;</td></tr>
  <tr><td>2</td><td> NCA</td><td>
   <tt>92</tt> <i>label x y layer_index</i>;</td></tr>
  <tr><td>3</td><td> Mextra</td><td>
   <tt>94</tt> <i>label x y layer_name</i>;</td></tr>
  <tr><td>4</td><td> none</td><td> no labels used</td></tr>
  </table>

  <p>
  Unlike other extensions, the first extension listed above is unique
  to <i>Xic</i> (and the <i>FileTool</i>).  If other formats are used,
  label size and orientation information will be lost.  When reading
  CIF input, any of these forms will be accepted.
  </dl>

  <dl>
  <dt><b>GdsOutLevel</b><dd>
  <b>Value:</b> integer 0-2.<br>
  This variable determines the GDSII release level of GDSII output
  files.  The default is release level 7, which was introduced by
  Cadence in 2002.  Previous releases specified a limit of 200 or 600
  polygon vertices (there seems to be some inconsistency in the
  published limit) and 200 vertices for wires.  This applies to format
  releases 3, 4, 5, and 6.  The only difference between these formats
  is the definition of some Cadence-specific data block types that are
  ignored by the <i>FileTool</i>.  The latest release (7) removed
  these limits.  The limits that remain are due to the block size
  limit (64Kb) of the format, which implies a maximum of 8000 vertices
  for polygons and wires.

  <p>
  When writing GDSII output, it may be necessary to enforce the
  limits, if the output is destined for another program which can't
  handle the release 7 limits.  The <i>Xic</i> default is to use the
  release 7 limits.

  <p>
  The <b>GdsOutLevel</b> variable can be set to an integer 0-2.
  The corresponding GDSII format is as follows:

  <dl>
  <dt>level 0: (the default)<dd>
    max poly vertices: 8000<br>
    max wire vertices: 8000<br>
    format level: 7<br>
  <dt>level 1:<dd>
    max poly vertices: 600<br>
    max wire vertices: 200<br>
    format level: 3<br>
  <dt>level 2:<dd>
    max poly vertices: 200<br>
    max wire vertices: 200<br>
    format level: 3
  </dl>

  <p>
  By setting <b>GdsOutLevel</b> to 1 or 2, GDSII files generated
  with <i>Xic</i> should not cause difficulty when read by older
  programs (including old versions of <i>Xic</i>).
  </dl>

  <dl>
  <dt><b>GdsMunit</b><dd>
  <b>Value:</b> real 0.01 - 100.0.<br>
  When writing GDSII, the normal MUNITS value (1e-9) is multiplied by
  this factor when written to the file.  This should be accompanied by
  a compensating scale factor change in order to keep the file scaling
  constant, unless a change of scale is desired.  The acceptable range
  is 0.01 - 100.0.
  </dl>

  <dl>
  <dt><b>OasWriteCompressed</b><dd>
  <b>Value:</b> boolean.<br>
  When set, created OASIS files will use compression.  The content
  of all CELL records and name tables will be placed in CBLOCK
  records.  This can significantly reduce file size.  When not set,
  no compression will be used.
  </dl>

  <dl>
  <dt><b>OasWriteNameTab</b><dd>
  <b>Value:</b> boolean.<br>
  When set, all strings including cell names, properties, and labels
  are placed in strict-mode tables.  This will in most cases reduce
  file size.  When writing OASIS files the offset table is placed in
  the END record.

  <p>
  The string tables themselves are written just ahead of the END
  record (when tables are used).
  </dl>

  <dl>
  <dt><b>OasWriteRep</b><dd>
  <b>Value:</b> string or boolean.<br>
  When this variable is set, the <i>FileTool</i> will try to find
  groups of identical objects that can be combined into REPETITION
  records in OASIS output.  This applies to all OASIS output files. 
  Although compute intensive, this can save a lot of space in the
  output file.

  <p>
  If <b>OasWriteRep</b> is not set, subcell and object records are
  written as encountered when traversing the cell structure.  If
  set, objects and subcells will be cached, and similar objects and
  subcells are identified and written using repetition records.

  <p>
  When using repetition, the following procedure is used, where
  "objects" can apply to subcells as well as geometrical objects.

  <ol>
  <li>Instead of directly converting each object, the object is
     saved in a cache.
  <p>
  <li>When a cell traversal is complete or an object count reached,
     the cache is processed, and objects that are identical are
     identified.  The differing objects are sorted to make use of
     modal variables.
  <p>
  <li>For each group of identical objects, those that form a
     spatially linear, periodic "run" are extracted into a new run
     list.
  <p>
  <li>For each list of runs, the runs that are spatially periodic
     are extracted into a new array list.
  <p>
  <li>Each array is written using a 2-dimensional repetition.
  <p>
  <li>Each remaining run is written using a 1-dimensional
     repetition.
  <p>
  <li>The remaining objects, i.e., those not used in an array or
     run, are written using a random repetition.
  </ol>

  <p>
  The details of this process, and whether or not it is applied,
  are controlled by the <b>OasWriteRep</b> variable.  This variable
  can be set to a string containing several tokens, or set as a
  boolean (i.e., set to nothing).  The tokens can appear in any
  order.

  <blockquote>
  <b>OasWriteRep</b>: [<i>word</i>] [<tt>d</tt>] [<tt>r</tt>]
   [<tt>m</tt>=<i>N</i>] [<tt>a</tt>=<i>N</i>]
  </blockquote>
  <dl>
  <dt><i>word</i><dd>
  This is a token that is not recognized as one of the others.  It
  consists of letters that control the type of object that the
  replication process is applied to.  If the letter is present, the
  corresponding object type will be processed, otherwise the
  replication algorithm will not be applied to that type of object,
  however if this token is not found (no letters appear), all
  objects will be processed.  The letters are:
  <blockquote>
  <table border=0>
  <tr><td width=10><tt>c</tt></td>   <td>subcells</td></tr>
  <tr><td width=10><tt>b</tt></td>   <td>boxes</td></tr>
  <tr><td width=10><tt>p</tt></td>   <td>polygons</td></tr>
  <tr><td width=10><tt>w</tt></td>   <td>wires</td></tr>
  <tr><td width=10><tt>l</tt></td>   <td>labels</td></tr>
  </table>
  </blockquote>

  <p>
  For example, "<tt>cp</tt>" would indicate use of repetition for
  subcells and polygons only.  If no token of this type is found,
  then <i>all</i> object types will be processed.
  </dl>

  <p>
  The remaining tokens are identified by the first letter only, and
  the remainder of the token (up to '=' in some cases) is ignored.

  <dl>
  <dt><tt>d</tt><dd>
  Some debugging info is printed on the console when processing.
  </dl>

  <dl>
  <dt><tt>r</tt><dd>
  No attempt is made to find runs or arrays, and all similar
  objects are written using random placement repetitions.
  </dl>

  <dl>
  <dt><tt>m</tt>=<i>N</i><dd>
  This sets the minimum number of objects in a run.  The default
  value is three.  There can be no space around the '=', and
  <i>N</i> must be an integer.  This is ignored if <tt>r</tt> is
  given.
  </dl>

  <dl>
  <dt><tt>a</tt>=<i>N</i><dd>
  This sets the minimum number of runs in an array.  The default
  value is two.  There can be no space around the '=', and <i>N</i>
  must be an integer.  This is ignored if <tt>r</tt> is given.
  </dl>


  <p>
  If <b>OasWriteRep</b> is set to an empty string, all objects will
  be processed for replication, using the default run and array
  minimums.
  </dl>

  <dl>
  <dt><b>OasWriteChecksum</b><dd>
  <b>Value:</b> string or boolean.<br>
  When not set, no checksum is written to the output.  When set as a
  boolean (i.e., to no value), or to anything other than
  "<tt>2</tt>" or a string beginning with "<tt>ch</tt>", a
  cyclic-redundancy (CRC) checksum is computed and added to the
  file.  If set to "<tt>2</tt>" or a word beginning with
  "<tt>ch</tt>", a byte-sum checksum is added to the file.
  </dl>

  <dl>
  <dt><b>OasWriteNoTrapezoids</b><dd>
  <b>Value:</b> boolean.<br>
  The normal behavior is to check three and four-sided polygons to
  see if they can be written as (more compact) TRAPEZOID or
  CTRAPEZOID records.  Setting this variable will suppress this,
  providing slightly faster conversion at the cost of larger file
  size.
  </dl>

  <dl>
  <dt><b>OasWriteWireToBox</b><dd>
  <b>Value:</b> boolean.<br>
  The normal behavior is to leave wires alone, preserving data-type
  integrity.  However, space can be saved by writing two-vertex
  rectangular wires as boxes.  Setting this variable will enable
  this, which may reduce file size at the expense of slightly more
  conversion time.
  </dl>

  <dl>
  <dt><b>OasWriteNoGCDcheck</b><dd>
  <b>Value:</b> boolean.<br>
  This applies only when repetitions are being used
  (<b>OasWriteRep</b> is set).  Normally, a greatest common divisor is
  computed, and if larger than unity type 10 repetitions are converted
  to type 11.  This can reduce file size.  If this variable is set,
  the GCD is not computed, probably increasing file size but reducing
  conversion time.
  </dl>
</dl>

<p>
The <tt>-o</tt> option, which specifies the output file to create, is
mandatory.  The format of the output file is determined from the
extension characters, which must match an extension from the following
table.

<blockquote>
<table border=0 cellpadding=2>
<tr><td>CGX</td>     <td><tt>.cgx</tt></td></tr>
<tr><td>CIF</td>     <td><tt>.cif</tt></td></tr>
<tr><td>GDSII</td>   <td><tt>.gds, .str, .strm, .stream</tt></td></tr>
<tr><td>OASIS</td>   <td><tt>.oas</tt></td></tr>
</table>
</blockquote>
Only these extensions are recognized, however CGX and GDSII allow
an additional <tt>.gz</tt> which will imply compression.  Input
file types are recognized by content, so there is no name
requirement.

<p>
The <tt>-t</tt> option specifies the name of a top-level cell that will
be created in the output file, and will be the parent cell for all
instances written to the file.  This is optional.  If no top-level cell
is given, cell definitions extracted from input files will simply be copied
in to the output file.

<p>
The <tt>-v</tt> option turns on message reporting during processing,
otherwise the action is silent.  The <tt>-vv</tt> option is a more
verbose variation.

<p>
There are two classes of modification options:  the per-source and
per-instance options.  The per-source options apply to input files, the
per-instance options apply to instantiations of cells extracted from
the input files.

<p>
Input files are specified with the <tt>-i</tt> option.  There must be at least
one input file specified.  A <tt>-i</tt> option begins a block of option
specifiers that apply only to that source file, which is terminated by the
next <tt>-i</tt> option or the end of the argument list.  A per-source or
per-instance option that appears ahead of the first <tt>-i</tt> option
will apply to all of the source (<tt>-i</tt>) blocks.  If these options
appear within a source block (after <tt>-i</tt>) they apply only to
that block, and override any options set outside.

<p>
Within a source block, the <tt>-c</tt> option specifies that name of
a cell, which must be found in the associated source file.  This cell, and
its sub-hierarchy, will be extracted from the file.  The <tt>-ctop</tt>
option is similar, and indicates the first top-level cell found in the
file.  This variation does not require knowing the name of a cell.

<p>
The <tt>-c</tt> or <tt>-ctop</tt> begins an instance block, which
terminates at the next <tt>-c</tt>/<tt>-ctop</tt> or the end of the
source block.  Each source block can have zero or more instance
blocks.  The hierarchy under the indicated cell will be extracted and
added to the created top-level cell if <tt>-t</tt> was given, or
streamed if not.  If the <tt>-ca</tt> option is given, the cell will
be written using the alias name provided.  The <tt>-ca</tt> specifier
has scope limited to the instance block where it appears, and can only
appear within an instance block.  Whether or not <tt>-ca</tt> is
given, any cell name alteration will be applied.  The actual names
used in output will be internally altered if necessary so that each
output cell name is unique, by adding "<tt>$</tt><i>N</i>", where
<i>N</i> is an integer.

<p>
This can be followed by per-instance options, which apply to this
instance block only, and override options set outside of the instance
block.  Per-instance options can also be specified ahead of the
instance blocks, in which case they apply to all instance blocks in
the source block, and override per-instance options set outside of the
source blocks.

<p>
If a block matches a previous block except for the transformation
parameters (<tt>-x</tt>, <tt>-y</tt>, <tt>-ang</tt>, <tt>-m</tt>,
<tt>-my</tt>), then if a top-level cell was created (<tt>-t</tt>
given), an instance will be added with the new transform, as one would
expect.  However, if no top-level cell was created, there would be no
addition to output, i.e., such instance blocks are ignored.

<p>
Each of the cells given will be extracted from the input file and
written to the output file.  If no cells are given, the entire input
file will be copied to the output.

<p>
The following are the "source options".  If these appear ahead of the
first <tt>-i</tt> option, then they set defaults that apply to all
source blocks.  If they appear following a <tt>-i</tt> option, they
apply to that source block only and override any defaults.

<dl>
<dt><tt>-l</tt> <i>layer_list</i><dd>
This provides a list of layer reference names to be used for layer
exclusion.  The <i>layer_list</i> is a space-separated list of layer
name tokens, which must be quoted if the list contains more than one
item.  The layer name tokens designate layers used in the input file
to which the layer filtering is to be applied.  These would be text
tokens for CIF.  For GDSII and usually for OASIS and CGX, the
numerical layer and datatype numbers are encoded into a token to be
described.  The <i>FileTool</i> can handle layer and datatype numbers
in the range 0-65535, though the GDSII specification only uses 0-255.

<p>
There are actually two possible encodings.  The first is the form
L,D  where L is the decimal layer number and D the (decimal) datatype.
The two numbers are separated by a comma with no white space.  Both
numbers are in the range 0-65535.

<p>
<a name="lyrenc"></a>
The second encoding is of the form LLDD or LLLLDDDD, where the Ls
represent the layer number in hex, zero padded to two or four
characters, and the Ds are the datatype number.  If neither number is
larger than 255, the first form should be used, which can represent
numbers in the range 0-255.  If either number is larger than 255, the
second form must be used, to provide the full numerical range.

<p>
The <i>layer_list</i> is used in conjunction with the <tt>-n</tt> or
<tt>-k</tt> options, and is otherwise ignored.
</dl>

<dl>
<dt><tt>-n</tt><dd>
This specifies that only layers found in the <i>layer_list</i> will be
processed, others will be ignored.  This option can be turned off with
<tt>-n-</tt>, which can be used for overriding.  The form <tt>-n+</tt>
is a synonym for <tt>-n</tt>.
</dl>

<dl>
<dt><tt>-k</tt><dd>
This specifies that layers found in the <i>layer_list</i> will be
ignored, all others will be processed.  This option can be turned off
with <tt>-k-</tt>, which can be used for overriding.  The form
<tt>-k+</tt> is a synonym for <tt>-k</tt>.
</dl>

<dl>
<dt><tt>-a</tt> <i>layer_aliases</i><dd>
This provides a mapping for changing layers in output.  The
<i>layer_aliases</i> is a space-separated list in the form
<blockquote>
 <i>name1</i>=<i>alias1</i> <i>name2</i>=<i>alias2</i> ...
</blockquote>
The list should be quoted if it contains more than one entry.  There
should be no white space around the '=' separators.  The objects on
layer <i>name1</i> will be written on layer <i>alias1</i> in output,
etc.  The names are all in the same format as used in the
<i>layer_list</i>.  This option can be set to an empty string ("")
to override an alias list already in scope.
</dl>

<dl>
<dt><tt>-s</tt> <i>scale</i><dd>
This provides a scale factor to apply to all coordinates read from the
source.  The possible values are 0.001 through 1000.0, with unity
being the default.  This will scale the coordinates in the cell
definitions.  Note that scaling can also be obtained by using a
magnification factor when instantiating the hierarchy in the created
top-level cell, when the <tt>-t</tt> option is used.  This option
can be set to 1.0 to effectively override a scaling already in scope.
</dl>

<dl>
<dt><tt>-p</tt> <i>prefix</i><dd>
Cell name change prefix.  This operation occurs after case conversion
(<tt>-tlo</tt> or <tt>-tup</tt>) if specified.  This is most simply
set to a text token that will be added to the beginning of cell name
strings as source files are being read.  The prefix can also be given
in the form <blockquote> /<i>str</i>/<i>sub</i>/ </blockquote> where
<i>str</i> and <i>sub</i> are text tokens, separated by forward slash
characters as shown.  In this case if the characters at the beginning
of the cell name match the <i>str</i>, they are replaced by
<i>sub</i>.  The string token must match exactly - there is no
wildcarding.  The prefix substitution occurs before suffix
substitution, when both are enabled.  Either can match the whole cell
name if one wants to change the name of a single cell.

<p>
This option can be set to an empty string ("") to override a prefix
already in scope.
</dl>

<dl>
<dt><tt>-u</tt> <i>suffix</i><dd>
Cell name change suffix.  This is analogous to the <tt>-p</tt> option,
but operates on the characters at the end of the cell names.  The
suffix substitution occurs after the prefix substitution, when both
are enabled.

<p>
This option can be set to an empty string ("") to override a suffix
already in scope.
</dl>

<dl>
<dt><tt>-tlo</tt><dd>
Flag to indicate conversion of upper case cell names to lower case. 
Mixed-case names are not changed.  This is done before prefix/suffix
processing.  This option can be turned off with <tt>-tlo-</tt>, which
can be used for overriding.  The form <tt>-tlo+</tt> is a synonym for
<tt>-tlo</tt>.
</dl>

<dl>
<dt><tt>-tup</tt><dd>
Flag to indicate conversion of lower case cell names to upper case. 
Mixed-case names are not changed.  This is done before prefix/suffix
processing.  This option can be turned off with <tt>-tup-</tt>, which
can be used for overriding.  The form <tt>-tup+</tt> is a synonym for
<tt>-tup</tt>.
</dl>


<p>
The following are the "instance options".  If these appear ahead of
the first <tt>-i</tt> option, the option sets a default which is
applied to all instances in all source blocks.  If these appear after
a <tt>-i</tt> option but ahead of the first <tt>-c</tt>/<tt>-ctop</tt>
option in the block, the option sets a default which applies to all
instances in the source block, overriding any defaults.  If these
appear following a <tt>-c</tt>/<tt>-ctop</tt> option, the option
applies to that instance only and overrides all defaults.  These will
be ignored in source blocks that contain no instances.

<dl>
<dt><tt>-x</tt> <i>x</i><dd>
Specify the translation X coordinate.  If not given, the default is 0.
This can be set to 0 to override a value already in scope.
</dl>

<dl>
<dt><tt>-y</tt> <i>y</i><dd>
Specify the translation Y coordinate.  If not given, the default is 0. 
This can be set to 0 to override a value already in scope.
</dl>

<dl>
<dt><tt>-ang</tt> <i>angle</i><dd>
Specify a rotation angle, which must be a multiple of 45 degrees.  If
not given, there will be no rotation.  This can be set to 0 to
override a value already in scope.
</dl>

<dl>
<dt><tt>-m</tt> <i>magn</i><dd>
Specify a magnification.  If not given, the default is 1.0.  This can
be set to 1.0 to override a value already in scope.
</dl>

<dl>
<dt><tt>-my</tt><dd>
Apply mirror-Y transformation (before rotation, if any).  This option
can be turned off with <tt>-my-</tt>, which can be used for
overriding.  The form <tt>-my+</tt> is a synonym for <tt>-my</tt>.
</dl>

<dl>
<dt><tt>-e</tt><dd>
If given, empty cells in the hierarchy of the cell being processed
will not be written to output.  Layer filtering will often produce
empty cells.  This option can be turned off with <tt>-e-</tt>, which
can be used for overriding.  The form <tt>-e+</tt> is a synonym for
<tt>-e</tt>.
</dl>

<dl>
<dt><tt>-f</tt><dd>
If given, all geometry under the cell being placed will be written as
part of the cell being placed, i.e., the cell hierarchy will be
flattened.  This option can be turned off with <tt>-f-</tt>, which can
be used for overriding.  The form <tt>-f+</tt> is a synonym for
<tt>-f</tt>.
</dl>

<dl>
<dt><tt>-w</tt> <i>l,b,r,t</i><dd>
If given, only the subcells and objects needed to describe the given
area in the cell being processed will be written.  The coordinates
apply to the cell before any scaling is applied, and are given in
microns.  The values are left, bottom, right, and top, separated by
commas with no white space.  One can give all zeros, or simply a
single 0, to turn of windowing as an override.
</dl>

<dl>
<dt><tt>-clip</tt><dd>
If <tt>-w</tt> was given, this will cause geometry to be clipped to
the window.  This option can be turned off with <tt>-clip-</tt>, which
can be used for overriding.  The form <tt>-clip+</tt> is a synonym for
<tt>-clip</tt>.
</dl>


<a name="format"></a>
<h2>5. The Script File Format</h2>

<p>
The processing can be controlled by a specification file which
supplies the file names and the description of the top-level cell. 
It is a simple text file, prepared by the user or generated with
the <tt>-d</tt> option of the <i>FileTool</i>, containing a number
of keywords with values.  This section describes the format.  The
structure and logic is reminiscent of the <i>FileTool</i> command
line options for synthesis.

<p>
The file used for output must have a recognized extension
that corresponds to the file type.  These are:
<table border = 0 cellpadding=2>
<tr><td>CGX</td>     <td><tt>.cgx</tt></td></tr>
<tr><td>CIF</td>     <td><tt>.cif</tt></td></tr>
<tr><td>GDSII</td>   <td><tt>.gds, .str, .strm, .stream</tt></td></tr>
<tr><td>OASIS</td>   <td><tt>.oas</tt></td></tr>
</table>
Only these extensions are recognized, however CGX and GDSII allow
an additional <tt>.gz</tt> which will imply compression.  Input
file types are recognized by content, so there is no name
requirement.

<p>
Below is a description of a specification file.  Blank lines are
ignored, comment lines begin with the '<tt>#</tt>' character.
Each active line begins with a keyword, from the list below.
Keywords are case-insensitive.

<dl>
<dt><tt>OutFile</tt> <i>out_file_name</i><dd>
This is mandatory, and provides the name of the output file.
</dl>

<dl>
<dt><tt>TopCell</tt> <i>cellname</i><dd>
Optional top-level cell added for placing subcells found in source
files.
</dl>

<dl>
<dt><tt>Source</tt> <i>filename</i><dd>
Name of a source file, of which there must be one or more.  This
starts a block of lines that apply to that source.  For best (or
sometimes even acceptable) performance, the input file should
<i>not</i> be compressed if any <tt>Place</tt> lines (see below)
are associated.
</dl>

<p>
The following are the "source options".  If these appear ahead of
the first <tt>Source</tt> line, then they set defaults that apply
to all source blocks.  If they appear following a <tt>Source</tt>
line, they apply to that source only and override any defaults.

<dl>
<dt><tt>OnlyLayers</tt> [<i>list_of_layer_names</i>]<dd>
Use only the layers listed.  If no <i>list_of_layer_names</i> is
found, the list that applies is taken from the list provided by
any of <tt>OnlyLayers</tt>, <tt>SkipLayers</tt>, or
<tt>LayerList</tt> currently in scope.
</dl>

<dl>
<dt><tt>SkipLayers</tt> [<i>list_of_layer_names</i>]<dd>
Skip the layers in the list.  If no <i>list_of_layer_names</i> is
found, the list that applies is taken from the list provided by
any of <tt>OnlyLayers</tt>, <tt>SkipLayers</tt>, or
<tt>LayerList</tt> currently in scope.
</dl>

<dl>
<dt><tt>LayerList</tt> <i>list_of_layer_names</i><dd>
Set the list of layers to be used with <tt>OnlyLayers</tt> or
<tt>SkipLayers</tt>.  This is implied when a
<i>list_of_layer_names</i> is provided with these keywords.
</dl>

<dl>
<dt><tt>LayerAliases</tt> <i>name1</i>=<i>alias1</i>
  <i>name2</i>=<i>alias2</i> ...<dd>
List of layer aliases to apply.
</dl>

<dl>
<dt><tt>ConvertScale</tt> <i>scale_factor</i><dd>
Scaling to apply, 0.001 through 1000.0.
</dl>

<dl>
<dt><tt>ToLower</tt><dd>
Flag to indicate conversion of upper case cell names to lower
case.
</dl>

<dl>
<dt><tt>ToUpper</tt><dd>
Flag to indicate conversion of lower case cell names to upper
case.
</dl>

<dl>
<dt><tt>CellNamePrefix</tt> <i>prefix_string</i><dd>
Cell name change prefix.  This operation occurs after case conversion. 
The <i>prefix_string</i> is interpreted in the manner of the
<tt>-p</tt> option to the <i>FileTool</i>.
</dl>

<dl>
<dt><tt>CellNameSuffix</tt> <i>suffix_string</i><dd>
Cell name change suffix.  This operation occurs after case conversion. 
The <i>suffix_string</i> is interpreted in the manner of the
<tt>-u</tt> option to the <i>FileTool</i>.
</dl>

<p>
This concludes the source options.

<dl>
<dt><tt>Place</tt> <i>cellname</i> [<i>placement_name</i>]<dd>
Each source block can have zero or more instance blocks.  An
instance block starts with a <tt>Place</tt> line as shown.  The
hierarchy under <i>cellname</i>, which must name a cell in the
source file, will be extracted and added to the <tt>TopCell</tt>,
if given, or streamed if not.  The <i>placement_name</i>, if
given, will replace <i>cellname</i> in output.  In either case,
any cell name alteration will be applied.  The actual names used
in output will be internally altered if necessary so that each
output cell name is unique, by adding "<tt>$</tt><i>N</i>", where
<i>N</i> is an integer.  If a block matches a previous block
except for the transformation parameters (<tt>Translate</tt>,
<tt>Rotate</tt>, <tt>Magnify</tt>, <tt>Reflect</tt>), then if a
<tt>TopCell</tt> was given, an instance will be added with the
new transform.  If no <tt>TopCell</tt>, there would be no
addition to output.
</dl>

<dl>
<dt><tt>PlaceTop</tt> [<i>placement_name</i>]<dd>
The <tt>PlaceTop</tt> line is equivalent to a <tt>Place</tt> line,
except that it will automatically select the first top-level cell
found in the source.  It is equivalent to the <tt>Place</tt> line
with the name of this cell as the first argument.  This is
convenient when the cell name is unknown.
</dl>

<p>
The following are the "instance options".  If these appear ahead
of the first <tt>Source</tt> line, the option sets a default
which is applied to all instances in all source blocks.  If these
appear after a <tt>Source</tt> line but ahead of the first
<tt>Place</tt> line in the block, the option sets a default which
applies to all instances in the source block, overriding any
defaults.  If these appear following a <tt>Place</tt> line, the
option applies to that instance only and overrides all defaults.
These will be ignored in source blocks that contain no instances.

<dl>
<dt><tt>Translate</tt> <i>x y</i><dd>
Specify the translation coordinates.  If not given, default is 0, 0.
</dl>

<dl>
<td><tt>Rotate</tt> <i>angle</i><dd>
Specify a rotation angle, must be a multiple of 45 degrees.  If not
given, default is no rotation.
</dl>

<dl>
<td><tt>Magnify</tt> <i>magn</i><dd>
Specify a magnification.  If not given, default is 1.0.
</dl>

<dl>
<dt><tt>Reflect</tt><dd>
Apply mirror-Y transformation (before rotation, if any).
</dl>

<dl>
<dt><tt>NoEmpties</tt><dd>
If given, empty subcells under <i>cellname</i> will not be
written to output.  Layer filtering will often produce empty
cells.
</dl>

<dl>
<dt><tt>Flatten</tt><dd>
If given, all geometry under the cell being placed will be written
as part of the cell being placed, i.e., the cell hierarchy will be
flattened.
</dl>

<dl>
<dt><tt>Window</tt> <i>left bottom right top</i><dd>
If given, only the subcells and objects needed to describe the
given area in the cell being placed will be written.  The
coordinates apply to <i>cellname</i> before any scaling is
applied, and are given in microns.
</dl>

<dl>
<dt><tt>Clip</tt><dd>
If <tt>Window</tt> was given, this will cause geometry to be
clipped to the window.
</dl>

</body>
</html>

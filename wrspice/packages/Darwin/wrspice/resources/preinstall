#! /bin/sh
# $1 : the full path to the installation package
# $2 : the full path to the installation destination
# $3 : the mountpoint of the destination volume
# $4 : the root directory for the current System folder

prefix=$2
libdir=$prefix/xictools/wrspice

# The Gen 4 package name
pkgname="XicTools.WRspice.4"

# Back up config files
cfgfiles="mozyrc \
    news \
    wrspice_mesg \
    wrspiceinit"

for a in $cfgfiles; do
    if [ -f $libdir/startup/$a ]; then
        cp -pf $libdir/startup/$a $libdir/startup/$a.tmporig
    fi
done

# Do a manual un-install if an existing package is found, Apple's
# install system doesn't do this.  If no existing install, just remove
# the devkit.  Early packages weren't being registered, so this is
# needed to get rid of the bsimsoi example that was later removed.

dir_list=""
file_list=`pkgutil --files $pkgname 2>&1 > /dev/null`
if [ $? = 0 ]; then
    for a in $file_list; do
        if [ -d $prefix/$a ]; then
            dir_list="$prefix/$a $dir_list"
        else
            rm -f $prefix/$a
        fi
    done
    for a in $dir_list; do
        "rmdir $a 2>&1 > /dev/null"
    done
else
    rm -rf $prefix/xictools/devkit
fi


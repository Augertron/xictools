#######################################################################
LOCATION = xt_accs
#######################################################################

ACCS_VERSION = @ACCS_VERSION@
DATE = @DATE@

prefix = @prefix@
CXX = @CXX@
CC = @CC@
LINKCC = @LINKCC@
CFLAGS = @CFLAGSG@ @DYNAMIC_LIBS@ @UFLAGS@ -DXICTOOLS
LFLAGS = @LFLAGS@ @TOOLKITLFLAGS@ @UFLAGS@
MSLIBS = @MSLIBS@
LIBS = @LIBS@ @TOOLKITLIBS@ @EXTRALIBS@
OSNAME = @OSNAME@
GRPREF = @GRPREF@
DEPEND_PROG = @DEPEND_PROG@ @CFLAGSG@ @DYNAMIC_LIBS@ -DXICTOOLS
RANLIB = @RANLIB@
STDCLIB = @STDCLIB@
INSTALL = @INSTALL@
EXESUFFIX = @EXESUFFIX@
FILTER = @FILTER@
NTREGEX = @NTREGEX@
MOZYRES = @MOZYRES@
XEDRES = @XEDRES@
TOOLROOT = @TOOLROOT@
WINPTHREADFIX = @WINPTHREADFIX@

BASE = ../xt_base
INCLUDE = -I$(BASE)/include

INSTALL_BIN    = $(INSTALL) -s -c -m 0755
INSTALL_SCRIPT = $(INSTALL) -c -m 0755
INSTALL_LIB    = $(INSTALL) -c -m 0644
INSTALL_LIB_RO = $(INSTALL) -c -m 0444

CCFILES = fcpp.cc lstpack.cc lstunpack.cc

#######################################################################
####### Executable and related targets ################################

ACCESSORIES = fcpp lstpack lstunpack

all:  $(ACCESSORIES)

fcpp: fcpp.cc
	$(LINKCC) $(CFLAGS) $(INCLUDE) -o fcpp fcpp.cc \
  $(BASE)/lib/miscutil.a $(STDCLIB) $(WINPTHREADFIX)

lstpack: lstpack.cc
	$(LINKCC) $(CFLAGS) $(INCLUDE) -o lstpack lstpack.cc \
  $(BASE)/lib/miscutil.a $(STDCLIB) $(WINPTHREADFIX)

lstunpack: lstunpack.cc
	$(LINKCC) $(CFLAGS) $(INCLUDE) -o lstunpack lstunpack.cc \
  $(BASE)/lib/miscutil.a $(STDCLIB) $(WINPTHREADFIX)


.cc.o:
	$(CXX) $(CFLAGS) $(INCLUDE) -c $*.cc

#######################################################################
####### Recursively generate libraries ################################

$(BASE)/lib/miscutil.a::
	cd $(BASE)/miscutil; $(MAKE)
	if [ x$(NTREGEX) != x ]; then \
	    cd $(BASE)/miscutil/libregex; $(MAKE); \
	fi

#######################################################################
####### Dependencies in this directory ################################

depend:
	@echo depending in $(LOCATION)
	@if [ x$(DEPEND_DONE) = x ]; then \
	    echo DEPEND_DONE = 1 >> Makefile; \
	    $(DEPEND_PROG) $(INCLUDE) $(CCFILES) $(FILTER) >> Makefile; \
	fi

#######################################################################
####### Clean up ######################################################

eclean:
	-rm -f fcpp$(EXESUFFIX) lstpack$(EXESUFFIX) lstunpack$(EXESUFFIX)

clean: eclean
	-rm -f *.o

distclean: clean
	-rm -f Makefile
	(cd packages; $(MAKE) distclean)

#######################################################################
####### Installation ##################################################

INSTALL_PREFIX ?= $(prefix)
dst_lib = $(INSTALL_PREFIX)/$(TOOLROOT)
dst_bin = $(INSTALL_PREFIX)/$(TOOLROOT)/bin

install: install_test install_force

install_force: install_clean install_bin

install_bin: $(dst_bin)

install_test::
	@if [ $(INSTALL_PREFIX) = $prefix ]; then \
	    echo "No!  Use pagkage to install!"; \
	    exit 1; \
	fi

install_clean::
	-@for aa in $(ACCESSORIES); do \
	    rm -f $(dst_bin)/$$aa$(EXESUFFIX); \
	done

$(dst_bin)::
	@$(BASE)/util/mkdirpth $@
	for aa in $(ACCESSORIES); do \
	    $(INSTALL_BIN) $$aa$(EXESUFFIX) $@; \
	done

package::
	$(MAKE) $(ACCESSORIES)
	-rm -rf packages/root
	mkdir packages/root
	$(MAKE) INSTALL_PREFIX=packages/root$(prefix) install
	cd packages; make xt_accs-$(OSNAME)

#######################################################################

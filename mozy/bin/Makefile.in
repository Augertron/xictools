#######################################################################
# mozy/bin/Makefile.in
#######################################################################
# $Id:$
#######################################################################

MOZY_VERSION = 4.2.2

DATE = @DATE@

prefix = @prefix@
CXX = @CXX@
CC = @CC@
LINKCC = @LINKCC@
CFLAGS = @CFLAGSG@ @DYNAMIC_LIBS@ @UFLAGS@ -DXICTOOLS
LFLAGS = @LFLAGS@ @TOOLKITLFLAGS@ @UFLAGS@
MSLIBS = @MSLIBS@
LIBS = @LIBS@ @TOOLKITLIBS@ @EXTRALIBS@
OSNAME = @OSNAME@
GRPREF = @GRPREF@
DEPEND_PROG = @DEPEND_PROG@ @CFLAGSG@ @DYNAMIC_LIBS@ -DXICTOOLS
RANLIB = @RANLIB@
STDCLIB = @STDCLIB@
INSTALL = @INSTALL@
NTSUFFIX = @NTSUFFIX@
FILTER = @FILTER@
NTREGEX = @NTREGEX@
MOZYRES = @MOZYRES@
XEDRES = @XEDRES@
TOOLROOT = @TOOLROOT@
WINPTHREADFIX = @WINPTHREADFIX@

BASE = ../../xt_base
INCLUDE = -I../include -I$(BASE)/include

LOCAL_LIBS = \
  $(BASE)/lib/ginterf.a \
  ../lib/htm.a \
  ../lib/help.a \
  ../lib/update_itf.a \
  $(BASE)/lib/gtkinterf.a  \
  ../lib/gtkmozy.a \
  ../lib/imsave.a \
  $(BASE)/lib/miscutil.a \
  ../lib/httpget.a

INSTALL_BIN    = $(INSTALL) -s -c -m 0755
INSTALL_SCRIPT = $(INSTALL) -c -m 0755
INSTALL_LIB    = $(INSTALL) -c -m 0644
INSTALL_LIB_RO = $(INSTALL) -c -m 0444

SUBDIRS = ../src/gtkmozy ../src/help ../src/htm ../src/httpget \
  ../src/imsave ../src/upd

CCFILES = mozy.cc httpget.cc

#######################################################################
####### Executable and related targets ################################

all:  libraries mozy httpget

libraries:
	@for a in $(SUBDIRS); do \
	  (cd $$a; $(MAKE) ) \
	done

mozy: libraries mozy.o $(LOCAL_LIBS) $(MOZYRES) Makefile
	@echo $@: dynamic link mozy
	@$(LINKCC) $(NTNOCONS) -o mozy $(LFLAGS) mozy.o \
  $(LOCAL_LIBS) $(LOCAL_LIBS) $(NTREGEX) $(LIBS) $(MOZYRES) $(STDCLIB)

httpget: httpget.o $(LOCAL_LIBS)
	@echo $@: dynamic link httpget
	@$(LINKCC) -o httpget $(LFLAGS) httpget.o \
  $(LOCAL_LIBS) $(LOCAL_LIBS) $(LIBS) $(STDCLIB)

mozy.o: mozy.cc
	$(CXX) $(CFLAGS) -DPREFIX=\"$(prefix)\" \
  -DVERSION_STR=\"$(MOZY_VERSION)\" $(INCLUDE) -c mozy.cc

.cc.o:
	$(CXX) $(CFLAGS) $(INCLUDE) -c $*.cc

#######################################################################
####### Recursively generate libraries ################################

../lib/gtkmozy.a:
	cd ../src/gtkmozy; $(MAKE)

../lib/help.a:
	cd ../src/help; $(MAKE)

../lib/htm.a:
	cd ../src/htm; $(MAKE)

../lib/httpget.a:
	cd ../src/httpget; $(MAKE)

../lib/imsave.a:
	cd ../src/imsave; $(MAKE)

../lib/update_itf.a:
	cd ../src/update_itf; $(MAKE)

$(BASE)/lib/ginterf.a:
	cd $(BASED)/ginterf; $(MAKE)

$(BASE)/lib/gtkinterf.a:
	cd $(BASED)/gtkinterf; $(MAKE)

$(BASE)/lib/miscutil.a:
	cd $(BASED)/miscutil; $(MAKE)
	if [ x$(NTREGEX) != x ]; then \
	    cd $(BASE)/miscutil/libregex; $(MAKE); \
	fi

foo $(MOZYRES) $(XEDRES):
	cd $(@D); $(MAKE) $(@F)

#######################################################################
####### Dependencies in this directory ################################

depend::
	@echo depending in mozy/bin
	@if [ x$(DEPEND_DONE) = x ]; then \
	    echo DEPEND_DONE = 1 >> Makefile; \
	    $(DEPEND_PROG) $(INCLUDE) $(CCFILES) $(FILTER) >> Makefile; \
	fi
	@for a in $(SUBDIRS); do \
	  (cd $$a; $(MAKE) depend) \
	done

#######################################################################
####### Clean up ######################################################

eclean::
	-rm -f mozy$(NTSUFFIX) httpget$(NTSUFFIX) $(LIB_TARGET)

clean:: eclean
	-rm -f *.o
	@for a in $(SUBDIRS); do \
	  (cd $$a; $(MAKE) clean) \
	done

distclean:: eclean
	-rm -f *.o Makefile
	@for a in $(SUBDIRS); do \
	  (cd $$a; $(MAKE) distclean) \
	done

#######################################################################
####### Installation ##################################################


#######################################################################

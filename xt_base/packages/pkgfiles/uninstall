#! /bin/bash

windows=no
if [ -n "$COMSPEC" ]; then
    if [ -n "$(expr match $COMSPEC '.*\(\.exe\)')" ]; then
        windows=yes
    fi
fi
if [ $windows = no ]; then
    if [ `whoami` != root -a x$1 != x -a $1 != "-t" ]; then
        echo "You're not root, validating using sudo."
        sudo -v
        if [ $? != 0 ]; then
            echo Validation failed.
            exit 1
        fi
    fi
fi

programs="adms fastcap fasthenry mozy mrouter vl wrspice xic xtlserv"

dryrun=no
if [ x"$1" = x-t ]; then
    dryrun=yes
    shift
fi

list=$*
if [ -z "$list" ]; then
    echo
    echo "Usage:  uninstall [-t] arg1 [arg2 ...]"
    echo
    echo \
"The arguments are partial program names from among those listed
below.  Only the first few characters, to uniquely specify the name,
are required in each argument.  For each argument, if a corresponding
installed XicTools-4.3 package is found, it will be uninstalled.  The
argument can also be "all", in which case all corresponding
XicTools-4.3 installed packages will be uninstalled.  If the first
argument is \"-t\", the removal commands are printed but not executed. 
It is likely that you will need administrator or super-user
permissions to successfully uninstall packages."
    echo
    echo \
"Programs: $programs"
    echo
    exit 0
fi

for a in $list; do
    case $a in
    al|all)
        list=$programs
        break
        ;;
    esac
done

names=""
for a in $list; do
    case $a in
    ad|adm|adms)
        names="$names adms"
        ;;
    fc|fastc|fastca|fastcap)
        names="$names fastcap"
        ;;
    fh|fasth|fasthe|fasthen|fasthenr|fasthenry)
        names="$names fasthenry"
        ;;
    mo|moz|mozy)
        names="$names mozy"
        ;;
    mr|mro|mrou|mrout|mroute|mrouter)
        names="$names mrouter"
        ;;
    v|vl)
        names="$names vl"
        ;;
    w|wr|wrs|wrsp|wrspi|wrspic|wrspice)
        names="$names wrspice"
        ;;
    xi|xic)
        names="$names xic"
        ;;
    xt|xtl|xtls|xtlse|xtlser|xtlserv)
        names="$names xtlserv"
        ;;
    esac
done

if [ -n "$names" ]; then

    if [ $windows = yes ]; then
        if [ $dryrun = no ]; then
            sudo ../util/uninstall.bat $names
        else
            ../util/uninstall.bat -t $names
        fi
    elif [ $(uname) = Darwin ]; then
        if [ $dryrun = no ]; then
            sudo ../util/osx_uninstall $names
        else
            ../util/osx_uninstall -t $names
        fi
    else
        list=$(rpm -qa | grep ^xictools_)
        if [ -n "$list" ]; then
            for a in $names; do
                pname=xictools_$a
                for b in $list; do
                    if [[ $b = $pname* ]]; then
                        echo rpm -e $b
                        if [ $dryrun = no ]; then
                            sudo rpm -e $b
                        fi
                    fi
                done
            done
        fi
    fi
else
    echo "Nothing found to uninstall."
fi


#######################################################################
# xt_base/packages/Makefile.in
#######################################################################
# $Id: Makefile.in,v 1.26 2015/07/19 20:54:47 stevew Exp $
#######################################################################

ACCS_VERSION = @ACCS_VERSION@
OSNAME = @OSNAME@
PREFIX = @prefix@

RELEASE = ../version

dummy:

#---- package targets -----------------------------------
# Note:  when using set expansion, make variables seem to be
# implicitly quoted, so that these have to be moved to a shall
# variable for the splitting to work correctly.
#
.DEFAULT:
	@IFS="-"; \
	tok=$@; \
	set -- $$tok; \
	if [ -z $$2 ]; then \
	    echo "Unknown target $@"; \
	    exit; \
	fi; \
	$(MAKE) $$2; \
	cd $$2/$$1; $(MAKE) $$2

Darwin FreeBSD Linux Solaris Win32:
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

Darwin64:
	if [ ! -f $@ ]; then \
	    ln -s Darwin $@; \
	fi
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

Debian Debian64:
	if [ ! -f $@ ]; then \
	    ln -s Debian $@; \
	fi
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

FreeBSD7 FreeBSD8 FreeBSD9 FreeBSD10:
	if [ ! -f $@ ]; then \
	    ln -s FreeBSD $@; \
	fi
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

Linux2 LinuxRHEL3 LinuxRHEL4 LinuxRHEL5 LinuxRHEL6 LinuxRHEL7 \
  LinuxRHEL3_64 LinuxRHEL4_64 LinuxRHEL5_64 LinuxRHEL6_64 LinuxRHEL7_64 \
  LinuxOSuSE LinuxOSuSE_64:
	if [ ! -f $@ ]; then \
	    ln -s Linux $@; \
	fi
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

Solaris8 Solaris8_64:
	if [ ! -f $@ ]; then \
	    ln -s Solaris $@; \
	fi
	if [ ! -d root ]; then \
	    mkdir root; \
	fi

fetch::
	-@if [ ! -f files/fetch_form.html ]; then \
	    DIREC=`pwd`; cat files/fetch_form.sed | sed s%DIREC%$$DIREC% \
  > files/fetch_form.html; \
	fi
	mozy files/fetch_form.html &

clean::
	-@for a in Darwin/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@for a in Debian/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@for a in FreeBSD/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@for a in Linux/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@for a in Solaris/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@for a in Win32/*; do \
	    if [ -d $$a -a -f $$a/Makefile ]; then \
	        (cd $$a; $(MAKE) clean) \
	    fi \
	done
	-@rm -rf root

distclean: clean
	-@for a in Darwin* Debian* FreeBSD* Linux* Solaris*; do \
	    case $$a in \
	    Darwin*) \
	        if [ $$a != Darwin ]; then rm -f $$a; fi ;; \
	    Debian*) \
	        if [ $$a != Debian ]; then rm -f $$a; fi ;; \
	    FreeBSD*) \
	        if [ $$a != FreeBSD ]; then rm -f $$a; fi ;; \
	    Linux*) \
	        if [ $$a != Linux ]; then rm -f $$a; fi ;; \
	    Solaris*) \
	        if [ $$a != Solaris ]; then rm -f $$a; fi ;; \
	    esac \
	done
	cd util; $(MAKE) distclean;
	rm -f files/make_config files/fetch_form.html Makefile
	rm -rf pkgfiles

# make PROGS="..." install, "..." list: xic, xicii, wrspice, etc
#
install:
	@for a in $(PROGS); do \
	    vs=`$(RELEASE) $$a`; \
	    if [ x$vs = x ]; then \
	        echo Unknown program: $$a; \
	        continue; \
	    fi; \
	    fn=`util/wr_filename $$a $(OSNAME) $$vs`; \
            if [ ! -f pkgfiles/$$fn ]; then \
	        echo Not found: pkgfiles/$$fn; \
	        continue; \
	    fi; \
	    if [ x"$arg" = x ]; then \
	        arg=pkgfiles/$$fn; \
	    else \
	        arg="$$arg pkgfiles/$$fn"; \
	    fi; \
	done; \
	util/wr_install $$arg

